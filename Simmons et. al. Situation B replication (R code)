# Brian Sergi 
# HW 19-704 
# 3/24/2015

# This R code attempts to replicate the results from Situation B in Simmons et. al. (2011), a study
# which found that higher proportion of false positives when adding 10 additional observations relative 
# to the rate predicted by the significance level of the test being conducted

# function attempts to simulate Situation B in Simmons et. al. (2011)
SituationB <- function(pval){     # input pval = significance level to be tested at
  
  # Normal random vector with mean = 0, sd = 1 for group 2
  variable1 <- rnorm(20, 0, 1)        
  
  # Normal random vector with mean = 0, sd = 1 for group 2
  variable2 <- rnorm(20, 0, 1)        
  
  # Two-Sample t-test (assume equal variance)
  t.test1 <- t.test(variable1, variable2, var.equal = TRUE) 
  
  #signif = 1 if the t-test gives p < .05, 0 otherwise
  signif <- ifelse(t.test1$p.value < pval,
                   1, # test is significant at pval level
                   0) # test is not significant at pval level
  
  # if the test is not signficant collect 10 additional observations 
  if(signif == 0){
    # 10 additional observations for group 1
    variable1 <- c(variable1, rnorm(10, 0, 1))
      
    # 10 additional observations for group 2
    variable2 <- c(variable2, rnorm(10, 0, 1))
        
    #Two-Sample t-tests
    t.test1 <- t.test(variable1, variable2, var.equal = TRUE) # Assumes equal var
    
    # retest for signficance after taking additional observations
    signif <- ifelse(t.test1$p.value < pval,
                     1, # test is significant at pval level
                     0) # test is not significant at pval level 
  }
  
  # output significance
  return(signif)
}

# simulate Situation B 15,000 times at 5% significance level
replicates <- replicate(15000, SituationB(0.05))

# calculate the number of times any of the three tests was signficant 
# (null hypothesis rejected)  across the 15,000 trials
SitBsum1 <- mean(replicates); SitBsum1

# repeat simulation at 10% significance level
replicates <- replicate(15000, SituationB(0.10))
SitBsum2 <- mean(replicates); SitBsum2

# repeat simulation at 1% significance level
replicates <- replicate(15000, SituationB(0.01))
SitBsum3 <- mean(replicates); SitBsum3
